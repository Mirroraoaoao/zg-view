# 集团数据驾驶舱 — UI 设计优化规划书

> **编制日期**：2026-02-09
> **项目**：zg-view (DHQ Charts)
> **技术栈**：Vue 3.5 + TypeScript 5.9 + Vite 7 + ECharts 6 + SCSS
> **前置文档**：`前端优化计划书_2026-02-09.md`（代码架构层已完成）、`子屏视觉规范_v1.md`（面板层次体系已建立）

---

## 一、背景与动机

前端架构优化（四阶段）已完成代码层面的清理、性能提升和数据层抽象；子屏视觉规范 v1 已建立面板层次模型（L0/L1/L2）。但在 **UI 交互体验、视觉一致性、动效体系、响应式精细度、图表复用性、无障碍完整性** 方面仍有系统性提升空间。

本规划聚焦 **设计体验层**，不涉及数据结构、指标口径等业务逻辑变更，也不涉及高对比度模式。

### 现状评分

| 维度 | 现状评分 | 目标评分 | 主要差距 |
|------|:------:|:------:|---------|
| 动效体系 | 6.5/10 | 8.5/10 | 缺少全局过渡变量、Tab 切换生硬、无路由过渡、无入场动画 |
| 视觉一致性 | 7/10 | 9/10 | 标题发光不统一、悬停反馈模式混用、边框色硬编码残留 |
| 响应式系统 | 7/10 | 8.5/10 | 变量分散重复、缺少大屏断点、存在硬编码尺寸 |
| 图表复用性 | 8/10 | 9/10 | 渐变色定义分散、缺少配置模板、tooltip 样式不统一 |
| 微交互体验 | 6/10 | 8.5/10 | 无数字滚动、无骨架屏、无面板折叠、无图表联动 |
| 无障碍支持 | 5/10 | 7.5/10 | 缺少 ARIA 标签、表格缺 scope、图表缺辅助描述 |

---

## 二、优化总览

| 阶段 | 方向 | 涉及范围 | 优先级 | 状态 |
|:----:|------|---------|:------:|:----:|
| P0 | 全局过渡变量 + 统一悬停状态 | 全站 | 最高 | 已完成 |
| P0 | 集中响应式变量 + 消除硬编码 | 全站 | 最高 | 已完成 |
| P1 | Tab 滑动指示条 + 面板入场动画 | 组件层 | 高 | 已完成 |
| P1 | 路由过渡动画 | App.vue | 高 | 已完成 |
| P1 | 图表预设模板 + 渐变色工厂 | 图表系统 | 高 | 已完成 |
| P1 | 统一面板标题组件 | 组件层 | 高 | 已完成 |
| P2 | KPI 数字滚动动画 | 数据展示 | 中 | 已完成 |
| P2 | 骨架屏加载态 | 数据展示 | 中 | 已完成 |
| P2 | 图表交互联动 | 图表系统 | 中 | 已完成 |
| P3 | 无障碍增强 (ARIA / scope / 键盘) | 全站 | 基础 | 已完成 |

---

## 三、P0 — 设计基础设施统一（最高优先级）

### 3.1 全局过渡变量体系

**问题现状**：
- 各组件各自定义过渡时长（`0.2s ease`、`0.3s ease`、`0.25s`），无统一节奏
- `SubScreenTabs.vue` 仅 `.tab-item` 有 `transition: color 0.2s ease`，激活条 `.active-bar` 使用 `v-if` 切换，无过渡动画
- `module-card` 的 `transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease` 是内联定义

**改造方案**：

在 `src/assets/styles/themes.scss` 的 `:root`（或 `main.scss` 的 `:root`）新增：

```scss
:root {
  // 过渡时间尺度
  --transition-fast: 0.15s;
  --transition-normal: 0.25s;
  --transition-slow: 0.4s;
  --transition-slower: 0.6s;

  // 缓动函数
  --ease-default: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
  --ease-smooth: cubic-bezier(0.25, 0.46, 0.45, 0.94);

  // 组合快捷变量
  --transition-color: color var(--transition-fast) var(--ease-default);
  --transition-transform: transform var(--transition-normal) var(--ease-default);
  --transition-opacity: opacity var(--transition-normal) var(--ease-default);
  --transition-shadow: box-shadow var(--transition-normal) var(--ease-default);
  --transition-border: border-color var(--transition-fast) var(--ease-default);
  --transition-bg: background var(--transition-normal) var(--ease-default);
}
```

**改造文件清单**：

| 文件 | 改造点 |
|------|--------|
| `themes.scss` 或 `main.scss` | 新增上述 CSS 变量 |
| `SubScreenTabs.vue` | `.tab-item` 过渡改用全局变量 |
| `SubScreenLayout.vue` | `.nav-item` 的 `transition: all 0.2s ease` → 引用全局变量 |
| `Portal.vue` | `.module-card` 的 `transition` → 引用全局变量 |
| 所有子屏 Detail 页面 | 面板/卡片如有内联过渡定义，统一替换 |

---

### 3.2 统一悬停状态规范

**问题现状**：
- `Portal.vue` 的 `.module-card:hover` 使用 `transform: translateY(-4px)` + `border-color` + `box-shadow` + `::after opacity`
- `SubScreenLayout.vue` 的 `.nav-item:hover` 使用 `border-color` + `box-shadow`
- 子屏内各面板的悬停反馈不统一或缺失

**统一规范**：

| 元素类型 | 悬停行为 | 参考实现 |
|---------|---------|---------|
| **可点击卡片**（module-card、hero） | 微上浮 + 边框提亮 + 外发光 | `transform: translateY(-3px)` + `border-color: rgba(90, 204, 255, 0.35)` + `box-shadow: 0 4px 24px rgba(90, 204, 255, 0.12)` |
| **导航项**（nav-item、tab-item） | 文字提亮 + 底部指示 | `color: var(--text-primary)` + 底部线条渐变 |
| **数据行**（table tr、列表项） | 行背景微亮 | `background: var(--table-row-hover)` |
| **芯片/标签**（chip、tag） | 边框微亮 | `border-color` 透明度提升 10% |

**实现方式**：在 `main.scss` 中定义 mixin 或工具类：

```scss
// 可点击卡片的统一悬停效果
@mixin card-hover($lift: -3px) {
  transition:
    var(--transition-transform),
    var(--transition-shadow),
    var(--transition-border);

  &:hover {
    transform: translateY($lift);
    border-color: rgba(90, 204, 255, 0.35);
    box-shadow: 0 4px 24px rgba(90, 204, 255, 0.12);
  }
}
```

---

### 3.3 集中响应式变量

**问题现状**：
- `Portal.vue` 定义了 `--space-1` ~ `--space-5`、`--text-xxs` ~ `--text-3xl`、`--card-gap` 等
- `SubScreenLayout.vue` 定义了 `--screen-space-1` ~ `--screen-space-4`、`--screen-text-xs` ~ `--screen-text-xl`，以及 `--panel-*`、`--kpi-*`、`--chip-*`、`--table-*` 等 30+ 变量
- 两处定义逻辑相似但变量名不同（`--space-*` vs `--screen-space-*`），存在语义割裂

**改造方案**：

在 `main.scss` 的 `:root` 中定义 **全局统一的响应式尺度**：

```scss
:root {
  // ── 间距尺度（Space Scale）──
  --space-1: clamp(6px, 0.5vw, 12px);
  --space-2: clamp(10px, 0.7vw, 18px);
  --space-3: clamp(14px, 0.9vw, 24px);
  --space-4: clamp(18px, 1.1vw, 32px);
  --space-5: clamp(22px, 1.3vw, 40px);

  // ── 文字尺度（Type Scale）──
  --text-xxs: clamp(9px, 0.48vw, 13px);
  --text-xs: clamp(11px, 0.55vw, 18px);
  --text-sm: clamp(12px, 0.65vw, 20px);
  --text-md: clamp(14px, 0.75vw, 22px);
  --text-lg: clamp(16px, 0.95vw, 26px);
  --text-xl: clamp(20px, 1.1vw, 30px);
  --text-2xl: clamp(24px, 1.4vw, 40px);
  --text-3xl: clamp(28px, 1.8vw, 52px);

  // ── 组件尺度（Component Scale）──
  --panel-padding: clamp(14px, 0.95vw, 24px);
  --panel-radius: clamp(14px, 1vw, 20px);
  --panel-title-size: var(--text-sm);
  --panel-title-gap: clamp(10px, 0.8vw, 18px);
  --panel-title-spacing: 0.14em;
  --panel-subtitle-size: var(--text-xs);
  --panel-chart-gap: clamp(6px, 0.6vw, 12px);
  --panel-table-gap: clamp(6px, 0.6vw, 12px);

  --kpi-padding: var(--space-2);
  --kpi-gap: var(--space-2);
  --kpi-radius: clamp(10px, 0.8vw, 16px);
  --kpi-min-width: clamp(150px, 10vw, 220px);
  --kpi-label-size: var(--text-xs);
  --kpi-value-size: var(--text-lg);
  --kpi-value-gap: var(--space-1);

  --chip-padding-y: clamp(4px, 0.3vw, 8px);
  --chip-padding-x: clamp(10px, 0.6vw, 16px);
  --chip-font-size: var(--text-xs);

  --progress-height: clamp(6px, 0.5vw, 10px);
  --table-font-size: var(--text-sm);
  --table-head-size: var(--text-xs);
  --table-head-spacing: 0.12em;
  --table-row-padding-y: clamp(8px, 0.6vw, 12px);
  --table-row-padding-x: clamp(10px, 0.7vw, 14px);
}
```

**改造要点**：
1. 将 `Portal.vue` 中的 `--space-*`、`--text-*` 定义 **删除**，改为引用全局 `:root` 变量
2. 将 `SubScreenLayout.vue` 中的 `--screen-space-*`、`--screen-text-*`、`--panel-*`、`--kpi-*` 等全部 **删除**，同样引用全局变量
3. 页面仅保留页面级独有的覆盖变量（如 Portal 独有的 `--card-gap`、`--metric-value`）

---

### 3.4 消除硬编码尺寸

**问题清单**：

| 文件 | 硬编码 | 替换为 |
|------|--------|--------|
| `Portal.vue` `.portal-top-decor-center` | `width: 1180px` | 已有 `max-width: 92vw`，改为 `width: clamp(680px, 62vw, 1180px)` |
| `SubScreenLayout.vue` `.screen-header` | `padding: 12px 18px` | `padding: var(--space-2) var(--space-3)` |
| `SubScreenLayout.vue` `.header-left` | `gap: 10px` | `gap: var(--space-2)` |
| `SubScreenLayout.vue` `.screen-nav` | `gap: 8px` | `gap: var(--space-1)` |
| `SubScreenLayout.vue` `.nav-item` | `padding: 8px 14px`, `font-size: 0.8rem` | `padding: var(--space-1) var(--space-2)`, `font-size: var(--text-xs)` |
| `SubScreenTabs.vue` `.sub-tabs` | `gap: 18px`, `padding: 0 8px 8px` | `gap: var(--space-3)`, `padding: 0 var(--space-1) var(--space-1)` |
| `SubScreenTabs.vue` `.tab-item` | `padding: 8px 0`, `font-size: 0.9rem` | `padding: var(--space-1) 0`, `font-size: var(--text-sm)` |

---

### 3.5 补充响应式断点

**现状**：仅有 `1200px`（平板/小屏）、`1400px`（中屏）两个断点。

**新增断点**：

| 断点 | 用途 | 调整策略 |
|------|------|---------|
| `2560px` | 2K 显示器 | 适当增大面板间距和字号上限，防止内容过于稀疏 |
| `3840px` | 4K 显示器 | 进一步放大间距，调整 Grid 列数，增加信息密度选项 |

**实现方式**：在 `main.scss` 中新增：

> 补充：在 `1920px`（FHD 大屏）及以上场景，优先提高字号可读性；在 `2560px` / `3840px` 再做进一步放大与密度调整。

```scss
@media (min-width: 1920px) {
  :root {
    --text-xxs: clamp(10px, 0.52vw, 14px);
    --text-xs: clamp(12px, 0.62vw, 20px);
    --text-sm: clamp(13px, 0.75vw, 24px);
    --text-md: clamp(15px, 0.85vw, 26px);
    --text-lg: clamp(18px, 1.05vw, 30px);
    --text-xl: clamp(22px, 1.2vw, 34px);
    --text-2xl: clamp(26px, 1.55vw, 44px);
    --text-3xl: clamp(30px, 2vw, 56px);
  }
}

@media (min-width: 2560px) {
  :root {
    --space-1: clamp(10px, 0.5vw, 16px);
    --space-2: clamp(14px, 0.7vw, 24px);
    --text-sm: clamp(14px, 0.65vw, 24px);
    --text-md: clamp(16px, 0.75vw, 28px);
    --panel-padding: clamp(18px, 0.95vw, 32px);
  }
}

@media (min-width: 3840px) {
  :root {
    --space-2: clamp(18px, 0.7vw, 30px);
    --text-lg: clamp(20px, 0.95vw, 34px);
    --panel-padding: clamp(22px, 0.95vw, 40px);
  }
}
```

---

## 四、P1 — 交互体验提升（高优先级）

### 4.1 SubScreenTabs 滑动指示条

**问题现状**：
`SubScreenTabs.vue` 的 `.active-bar` 使用 `v-if` 控制显隐，切换 Tab 时指示条直接消失/出现，没有滑动过渡。

**改造方案**：

将 `active-bar` 从 `v-if` 切换改为 **单独的绝对定位元素**，通过 `transform: translateX()` + `width` 过渡实现滑动效果：

```vue
<template>
  <div class="sub-tabs" ref="tabsRef">
    <div
      v-for="(tab, index) in tabs"
      :key="index"
      :ref="el => tabRefs[index] = el"
      class="tab-item"
      :class="{ active: modelValue === tab.value }"
      role="tab"
      tabindex="0"
      @click="$emit('update:modelValue', tab.value)"
      @keydown.enter="$emit('update:modelValue', tab.value)"
      @keydown.space.prevent="$emit('update:modelValue', tab.value)"
    >
      {{ tab.label }}
    </div>
    <!-- 滑动指示条 -->
    <div class="active-bar" :style="barStyle"></div>
  </div>
</template>
```

**核心逻辑**：
- 通过 `ref` 获取每个 tab 元素的 `offsetLeft` 和 `offsetWidth`
- 通过 `computed` 计算 `barStyle` 的 `transform: translateX(...)` 和 `width`
- CSS 上为 `.active-bar` 添加 `transition: transform var(--transition-normal) var(--ease-default), width var(--transition-normal) var(--ease-default)`

---

### 4.2 面板入场动画

**目标**：子屏页面加载时，各面板按照从上到下、从左到右的顺序交错入场，营造层次感。

**实现方案**：

1. 定义全局入场动画关键帧：

```scss
@keyframes panel-enter {
  from {
    opacity: 0;
    transform: translateY(16px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.panel-animate-in {
  animation: panel-enter var(--transition-slow) var(--ease-smooth) both;
}
```

2. 在子屏详情页的面板容器上使用 `animation-delay` 实现交错：

```vue
<div
  v-for="(panel, i) in panels"
  :key="i"
  class="section-panel panel-animate-in"
  :style="{ animationDelay: `${i * 80}ms` }"
>
```

3. 提供 `useStaggerAnimation` composable 简化使用：

```typescript
// src/composables/useStaggerAnimation.ts
export function useStaggerAnimation(count: number, baseDelay = 80) {
  return Array.from({ length: count }, (_, i) => ({
    animationDelay: `${i * baseDelay}ms`
  }))
}
```

**prefers-reduced-motion 兼容**：已有全局规则 `animation-duration: 0.01ms !important`，无需额外处理。

---

### 4.3 路由过渡动画

**目标**：页面切换时添加淡入淡出过渡，避免生硬跳转。

**实现方案**：

在 `App.vue` 中包裹 `<router-view>`：

```vue
<template>
  <router-view v-slot="{ Component, route }">
    <Transition :name="route.meta.transition || 'fade'" mode="out-in">
      <component :is="Component" :key="route.path" />
    </Transition>
  </router-view>
</template>
```

过渡样式（已有 `.fade-*` 定义在 `main.scss`，可直接使用）：

```scss
// 已存在于 main.scss
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.3s ease;
}
.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}
```

可选扩展 — 添加滑动过渡用于子屏间切换：

```scss
.slide-fade-enter-active {
  transition: all var(--transition-normal) var(--ease-default);
}
.slide-fade-leave-active {
  transition: all var(--transition-fast) var(--ease-default);
}
.slide-fade-enter-from {
  opacity: 0;
  transform: translateX(20px);
}
.slide-fade-leave-to {
  opacity: 0;
  transform: translateX(-20px);
}
```

---

### 4.4 图表预设模板 + 渐变色工厂

**问题现状**：
- `GeneralDetail.vue`、`FinanceDetail.vue` 等页面各自重复编写 `grid`、`tooltip`、`xAxis`、`yAxis` 配置
- 渐变色（`areaStyle.color.colorStops`）在多个页面中手动复制

**改造方案**：

#### 4.4.1 渐变色工厂

在 `src/utils/chartTheme.ts` 中新增：

```typescript
/**
 * 创建线性渐变色配置
 * @param color 语义色 key 或 hex 值
 * @param direction 'vertical' | 'horizontal'
 * @param startOpacity 起始透明度（默认 0.3）
 * @param endOpacity 结束透明度（默认 0）
 */
export function createGradient(
  color: string,
  direction: 'vertical' | 'horizontal' = 'vertical',
  startOpacity = 0.3,
  endOpacity = 0
) {
  const hex = semanticColors[color] || color
  const isVertical = direction === 'vertical'
  return {
    type: 'linear',
    x: 0, y: 0,
    x2: isVertical ? 0 : 1,
    y2: isVertical ? 1 : 0,
    colorStops: [
      { offset: 0, color: hex + Math.round(startOpacity * 255).toString(16).padStart(2, '0') },
      { offset: 1, color: hex + Math.round(endOpacity * 255).toString(16).padStart(2, '0') }
    ]
  }
}
```

使用示例（替换 `Portal.vue` 第 200-210 行手动渐变）：

```typescript
import { createGradient } from '../utils/chartTheme'

// 原来
areaStyle: {
  color: {
    type: 'linear', x: 0, y: 0, x2: 0, y2: 1,
    colorStops: [
      { offset: 0, color: colors.revenue + '30' },
      { offset: 1, color: 'rgba(12, 24, 40, 0)' }
    ]
  }
}

// 替换为
areaStyle: { color: createGradient('revenue', 'vertical', 0.19, 0) }
```

#### 4.4.2 图表预设模板

在 `src/utils/chartTheme.ts` 中新增预设导出：

```typescript
export function getBaseGridConfig(scale: ReturnType<typeof useResponsiveScale>) {
  return {
    top: scale.scaleNumber(24, 20),
    bottom: scale.scaleNumber(24, 20),
    left: scale.scaleNumber(48, 40),
    right: scale.scaleNumber(16, 12),
    containLabel: false
  }
}

export function getBaseTooltipConfig(colors: ReturnType<typeof getChartColors>, scale: ReturnType<typeof useResponsiveScale>) {
  return {
    trigger: 'axis' as const,
    backgroundColor: colors.bgPanel,
    borderColor: colors.border,
    textStyle: { color: colors.textPrimary, fontSize: scale.scaleNumber(11, 10) },
    axisPointer: { type: 'line' as const, lineStyle: { color: colors.border } }
  }
}

export function getBaseAxisConfig(colors: ReturnType<typeof getChartColors>, scale: ReturnType<typeof useResponsiveScale>) {
  return {
    xAxis: {
      axisLine: { lineStyle: { color: colors.axisLine } },
      axisTick: { show: false },
      axisLabel: { color: colors.textSecondary, fontSize: scale.scaleNumber(11, 10) }
    },
    yAxis: {
      axisLabel: { color: colors.textSecondary, fontSize: scale.scaleNumber(11, 10) },
      splitLine: { lineStyle: { color: colors.splitLine } }
    }
  }
}
```

页面使用时只需覆盖数据部分：

```typescript
const option = computed(() => {
  const colors = getChartColors()
  return {
    grid: getBaseGridConfig(scale),
    tooltip: getBaseTooltipConfig(colors, scale),
    ...getBaseAxisConfig(colors, scale),
    xAxis: { ...getBaseAxisConfig(colors, scale).xAxis, type: 'category', data: labels },
    series: [{ type: 'line', semantic: 'revenue', data: values }]
  }
})
```

---

### 4.5 统一面板标题组件 PanelHeader

**问题现状**：
- `Portal.vue` 的卡片标题 `.card-title` 使用 `var(--text-sm)` + `letter-spacing: 0.12em`，无发光效果
- 子屏详情页的 `.panel-title`（`main.scss`）使用 `var(--panel-title-size)` + `letter-spacing: 0.14em` + `color: var(--text-primary)`
- 标题装饰线、副标题样式各页面各异

**改造方案**：

提取公共组件 `src/components/PanelHeader.vue`：

```vue
<template>
  <div class="panel-header">
    <h3 class="panel-header__title">
      <slot>{{ title }}</slot>
    </h3>
    <p v-if="subtitle || $slots.subtitle" class="panel-header__subtitle">
      <slot name="subtitle">{{ subtitle }}</slot>
    </p>
  </div>
</template>

<script setup lang="ts">
defineProps<{
  title?: string
  subtitle?: string
}>()
</script>

<style scoped lang="scss">
.panel-header {
  margin-bottom: var(--panel-title-gap);
}

.panel-header__title {
  margin: 0;
  font-family: var(--font-display);
  font-size: var(--panel-title-size);
  letter-spacing: var(--panel-title-spacing);
  line-height: 1.2;
  text-transform: uppercase;
  color: var(--text-primary);
  text-shadow: none;
}

.panel-header__subtitle {
  margin: 4px 0 0;
  font-size: var(--panel-subtitle-size);
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: var(--text-muted);
}
</style>
```

**改造要点**：
- 所有子屏详情页的面板标题区域统一使用 `<PanelHeader>` 组件
- 删除各页面中的重复 `.panel-title` / `.section-title` 样式定义
- Portal 页面的卡片标题保持独立样式（Portal 与子屏的视觉层级不同）

---

## 五、P2 — 数据展示增强（中优先级）

### 5.1 KPI 数字滚动动画

**目标**：KPI 数值展示时从 0 滚动到目标值，增强数据冲击力和页面动态感。

**实现方案**：

创建 `src/composables/useCountUp.ts`：

```typescript
import { ref, watch, onMounted } from 'vue'

export function useCountUp(target: () => number, duration = 1200) {
  const display = ref(0)

  const animate = (end: number) => {
    const start = display.value
    const startTime = performance.now()

    const step = (now: number) => {
      const progress = Math.min((now - startTime) / duration, 1)
      // ease-out 缓动
      const eased = 1 - Math.pow(1 - progress, 3)
      display.value = Math.round(start + (end - start) * eased)
      if (progress < 1) requestAnimationFrame(step)
    }

    // 尊重 prefers-reduced-motion
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      display.value = end
    } else {
      requestAnimationFrame(step)
    }
  }

  onMounted(() => animate(target()))
  watch(target, (val) => animate(val))

  return display
}
```

**使用场景**：
- Portal 页面 Hero 区域的核心经营指标
- 各子屏详情页的 KPI 卡片数值
- 可选择性地应用于重点数字，不必全部应用

---

### 5.2 骨架屏加载态

**目标**：数据加载期间显示面板骨架屏，避免空白闪烁。当后续接入真实 API 后，加载态将变得更有意义。

**实现方案**：

创建 `src/components/SkeletonPanel.vue`：

```vue
<template>
  <div class="skeleton-panel panel">
    <div class="skeleton-bar title"></div>
    <div class="skeleton-bar subtitle"></div>
    <div class="skeleton-block chart"></div>
  </div>
</template>

<style scoped lang="scss">
.skeleton-bar {
  border-radius: 4px;
  background: linear-gradient(
    90deg,
    rgba(90, 204, 255, 0.06) 0%,
    rgba(90, 204, 255, 0.12) 50%,
    rgba(90, 204, 255, 0.06) 100%
  );
  background-size: 200% 100%;
  animation: skeleton-shimmer 1.5s ease-in-out infinite;
}

.skeleton-bar.title {
  width: 40%;
  height: var(--text-sm);
  margin-bottom: var(--space-2);
}

.skeleton-bar.subtitle {
  width: 25%;
  height: var(--text-xs);
  margin-bottom: var(--space-3);
}

.skeleton-block.chart {
  width: 100%;
  height: 180px;
  border-radius: var(--kpi-radius);
  background: linear-gradient(
    90deg,
    rgba(90, 204, 255, 0.04) 0%,
    rgba(90, 204, 255, 0.08) 50%,
    rgba(90, 204, 255, 0.04) 100%
  );
  background-size: 200% 100%;
  animation: skeleton-shimmer 1.5s ease-in-out infinite;
}

@keyframes skeleton-shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}
</style>
```

**使用方式**：

```vue
<template>
  <SkeletonPanel v-if="loading" />
  <div v-else class="section-panel panel">
    <!-- 实际内容 -->
  </div>
</template>
```

---

### 5.3 图表交互联动

**目标**：同一页面内的关联图表支持 brush 联动高亮，增强数据探索体验。

**实现方案**：

利用 ECharts 的 `connect` API，在 `BaseChart.vue` 中增加 `group` prop：

```vue
<script setup lang="ts">
const props = defineProps<{
  options: Record<string, unknown>
  group?: string  // 新增：图表联动组名
}>()

// 在 chart 初始化后
if (props.group && chartInstance) {
  chartInstance.group = props.group
  echarts.connect(props.group)
}
</script>
```

页面使用：

```vue
<!-- 同一页面中需要联动的图表指定相同 group -->
<BaseChart :options="revenueOption" group="finance-overview" />
<BaseChart :options="profitOption" group="finance-overview" />
```

效果：鼠标悬停其中一个图表的 tooltip 时，同组其他图表会同步显示对应时间点的 tooltip。

---

## 六、P3 — 无障碍增强（基础优先级）

### 6.1 ARIA 标签补充

**改造清单**：

| 组件/页面 | 当前问题 | 改造方案 |
|----------|---------|---------|
| `SubScreenLayout.vue` `<nav>` | 缺少 `aria-label` | 添加 `aria-label="模块导航"` |
| `SubScreenTabs.vue` `.sub-tabs` | 缺少 `role="tablist"` 和 `aria-label` | 添加 `role="tablist"` `aria-label="数据标签页"` |
| `SubScreenTabs.vue` `.tab-item` | 缺少 `aria-selected` | 添加 `:aria-selected="modelValue === tab.value"` |
| `BaseChart.vue` | 图表区域无辅助描述 | 添加 `role="img"` 和 `aria-label` prop |
| 所有 `.panel` 面板 | 无结构化标记 | 建议添加 `role="region"` + `aria-labelledby` 关联面板标题 |

---

### 6.2 表格语义化增强

当前 `.data-table` 的 `<th>` 缺少 `scope` 属性。

**改造方案**：

在所有使用 `<th>` 的位置添加 `scope="col"`（列标题）或 `scope="row"`（行标题）：

```html
<!-- 列标题 -->
<th scope="col">指标名称</th>
<th scope="col">当前值</th>
<th scope="col">同比</th>

<!-- 行标题（如适用） -->
<th scope="row">营业收入</th>
```

---

### 6.3 键盘导航完善

**改造清单**：

| 位置 | 当前问题 | 改造方案 |
|------|---------|---------|
| `SubScreenTabs.vue` | Tab 之间无箭头键导航 | 添加 `@keydown.left`/`@keydown.right` 切换焦点 |
| `SubScreenLayout.vue` `.nav-item` | 导航项间无箭头键支持 | 添加 `@keydown.left`/`@keydown.right` |
| 所有图表 | 无键盘交互 | ECharts 内置支持有限，考虑为图表添加 `aria-label` 描述数据趋势 |

**Tab 键盘导航实现参考**：

```vue
<script setup lang="ts">
const handleKeydown = (e: KeyboardEvent, index: number) => {
  let nextIndex = index
  if (e.key === 'ArrowRight') nextIndex = (index + 1) % props.tabs.length
  if (e.key === 'ArrowLeft') nextIndex = (index - 1 + props.tabs.length) % props.tabs.length
  if (nextIndex !== index) {
    e.preventDefault()
    tabRefs[nextIndex]?.focus()
    emit('update:modelValue', props.tabs[nextIndex].value)
  }
}
</script>
```

---

## 七、文件级改造清单汇总

| 文件 | P0 | P1 | P2 | P3 | 改造要点 |
|------|:--:|:--:|:--:|:--:|---------|
| `main.scss` | ✓ | ✓ | | | 全局过渡变量、响应式变量集中、入场动画关键帧、大屏断点 |
| `themes.scss` | ✓ | | | | 过渡变量定义（如与 main.scss 合并则忽略） |
| `SubScreenLayout.vue` | ✓ | | | ✓ | 删除重复变量、硬编码替换、nav ARIA 标签 |
| `SubScreenTabs.vue` | ✓ | ✓ | | ✓ | 硬编码替换、滑动指示条、ARIA + 键盘导航 |
| `Portal.vue` | ✓ | ✓ | ✓ | | 删除重复变量、硬编码替换、入场动画、数字滚动 |
| `App.vue` | | ✓ | | | 路由过渡动画 |
| `BaseChart.vue` | | ✓ | ✓ | ✓ | 图表联动 group prop、aria-label prop |
| `chartTheme.ts` | | ✓ | | | 渐变色工厂、图表预设模板 |
| **新建** `PanelHeader.vue` | | ✓ | | | 统一面板标题组件 |
| **新建** `SkeletonPanel.vue` | | | ✓ | | 骨架屏加载态 |
| **新建** `useCountUp.ts` | | | ✓ | | KPI 数字滚动 composable |
| **新建** `useStaggerAnimation.ts` | | ✓ | | | 面板交错入场 composable |
| 所有 Detail 页面 (×9) | ✓ | ✓ | ✓ | ✓ | 引用全局变量、使用 PanelHeader、入场动画、表格 scope |

---

## 八、实施顺序与依赖关系

```
P0-3.1 全局过渡变量
  │
  ├──→ P0-3.2 统一悬停状态（依赖过渡变量）
  │
  ├──→ P1-4.1 Tab 滑动指示条（依赖过渡变量）
  │
  └──→ P1-4.2 面板入场动画（依赖过渡变量）

P0-3.3 集中响应式变量
  │
  ├──→ P0-3.4 消除硬编码尺寸（依赖统一变量）
  │
  ├──→ P0-3.5 补充大屏断点（依赖统一变量）
  │
  └──→ P1-4.5 PanelHeader 组件（依赖统一变量）

P1-4.3 路由过渡动画 ← 独立，无依赖

P1-4.4 图表预设模板 + 渐变色工厂 ← 独立，无依赖

P2-5.1 KPI 数字滚动 ← 独立，无依赖
P2-5.2 骨架屏 ← 独立，无依赖
P2-5.3 图表联动 ← 依赖 BaseChart 改造

P3 无障碍 ← 部分依赖 P1 组件改造（SubScreenTabs）
```

**建议实施顺序**：
1. P0-3.1 → P0-3.2（过渡体系）
2. P0-3.3 → P0-3.4 → P0-3.5（响应式体系）— 可与上一步并行
3. P1-4.1（Tab 滑动指示条）
4. P1-4.2 + P1-4.3（入场动画 + 路由过渡）— 可并行
5. P1-4.4（图表模板）
6. P1-4.5（PanelHeader）
7. P2 各项 — 可并行
8. P3 无障碍 — 可穿插在以上各步骤中同步处理

---

## 九、验收标准

### P0 验收
- [x] 全站所有 `transition` 属性引用全局 CSS 变量，无硬编码时长
- [x] `Portal.vue` 和 `SubScreenLayout.vue` 不再定义重复的间距/字号变量
- [x] 全局搜索 `padding: \d+px` 和 `font-size: 0\.\d+rem` 在组件文件中不再出现（使用 CSS 变量替代）
- [x] 2560px 宽度下面板间距和字号适当放大
- [x] `npm run build` 通过

### P1 验收
- [x] SubScreenTabs 切换时指示条平滑滑动
- [x] 子屏详情页面板按交错顺序淡入上浮
- [x] 页面路由切换有淡入淡出过渡
- [x] 图表配置中不再出现重复的 `grid`/`tooltip`/`axis` 配置
- [x] 所有面板标题使用 `<PanelHeader>` 组件
- [x] `npm run build` 通过

### P2 验收
- [x] 至少 Portal Hero 区域和 1 个子屏的 KPI 数值有滚动入场效果
- [x] 数据加载态显示骨架屏（可在 service 层模拟延迟验证）
- [x] 同页面关联图表的 tooltip 联动同步
- [x] `prefers-reduced-motion` 下所有动画静默
- [x] `npm run build` 通过

### P3 验收
- [x] `<nav>` 和 `<div role="tablist">` 具备 `aria-label`
- [x] `<th>` 具备 `scope` 属性
- [x] Tab 组件支持左右箭头键切换
- [x] 图表容器具备 `role="img"` + `aria-label` 描述
- [x] `npm run build` 通过

---

## 十、风险与注意事项

| 风险 | 影响 | 缓解措施 |
|------|------|---------|
| 全局变量重构可能导致局部样式偏差 | 视觉回归 | 每完成一个页面即进行手工截图对比 |
| SubScreenTabs 滑动指示条在 Tab 数量变化时可能位置错误 | 交互异常 | 使用 `ResizeObserver` 监听容器变化，动态重算位置 |
| 路由过渡动画可能与现有 `overflow: hidden` 冲突 | 动画截断 | 过渡期间临时移除 `overflow: hidden` |
| 大屏断点样式未经真实设备验证 | 显示异常 | 使用浏览器 DevTools 模拟 2560/3840 分辨率 |
| 图表联动在图表数量多时可能产生性能开销 | 页面卡顿 | 仅对同一区域内的 2-3 个关联图表启用联动 |

---

## 计划状态
- 文档状态：**已完成**
- 编制时间：`2026-02-09`
- 完成时间：`2026-02-09`
- 版本基线：`2026-02-09`
