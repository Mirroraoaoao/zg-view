# 集团数据驾驶舱 - 前端优化计划书

> 编制日期：2026-02-09
> 项目：zg-view (DHQ Charts)
> 当前技术栈：Vue 3.5 + TypeScript 5.9 + Vite 7 + ECharts 6 + SCSS

---

## 一、优化背景

项目已完成核心功能开发，整体代码质量良好，UI/UX 和无障碍设计有较好的基础。但随着页面增多（11 个路由视图），出现了以下问题：

- **代码重复**：多个 view 中存在相同的响应式缩放逻辑
- **多主题残留**：项目当前仅使用深空模式（dark-space），但遗留了完整的多主题切换体系（约 400 行无效代码）
- **性能瓶颈**：路由未做懒加载、图表组件存在不必要的深度监听、DOM 查询未缓存
- **未使用代码**：4 个模块卡片组件和主题切换器组件完全未被引用
- **架构耦合**：视图层直接依赖 mock 数据结构，缺少数据抽象层
- **工程化不足**：缺少 ESLint/Prettier、类型定义不完整

---

## 二、优化总览

| 阶段 | 重点方向 | 涉及文件数 | 状态 | 预期效果 |
| :--- | :--- | :---: | :---: | :--- |
| 第一阶段 | 清理无效代码 + 性能提升 | ~15 | ✅ 已完成 | 减少约 400 行无效代码，首屏加载加快 |
| 第二阶段 | 核心组件优化 + 消除重复 | ~8 | ✅ 已完成 | 消除约 200 行重复代码，运行时性能提升 |
| 第三阶段 | 架构完善 + 数据层抽象 | ~12 | ✅ 已完成 | 提高可维护性，为 API 对接做准备 |
| 第四阶段 | 工程化 + 类型安全 | ~10 | ⏸️ 部分完成 | 统一代码规范，增强类型保障 |

---

## 三、第一阶段：清理无效代码 + 性能提升 ✅ 已完成

### 3.1 清除多主题残留代码 ✅

- 删除 `src/components/ThemeSwitcher.vue`（230 行）
- 删除 `src/stores/theme.ts`（48 行）
- 清理 `themes.scss` 中的多主题定义（约 350 行 → 115 行）
- 清理 `main.ts`、`BaseChart.vue`、`ParticlesBackground.vue` 中的主题相关代码

### 3.2 删除未使用的模块卡片组件 ✅

- 删除 `FinanceBudgetCard.vue`
- 删除 `TreasuryInvestCard.vue`
- 删除 `AssetOperationCard.vue`
- 删除 `ProjectOperationCard.vue`

### 3.3 路由懒加载 ✅

除 Portal（首页）外，其余 9 个子页面已改为动态导入。

---

## 四、第二阶段：核心组件优化 + 消除重复 ✅ 已完成

### 4.1 提取 `useResponsiveScale` composable ✅

- 新建 `src/composables/useResponsiveScale.ts`
- `Portal.vue`、`GeneralDetail.vue`、`FinanceDetail.vue` 等已替换使用

### 4.2 缓存 `getChartColors()` / `getThemeColors()` 结果 ✅

- `chartTheme.ts` 中已实现模块级缓存
- 移除 `Portal.vue` 中的重复实现

### 4.3 优化 BaseChart 的 watch 策略 ✅

- 移除冗余的 resize 监听

### 4.4 粒子背景性能优化 ✅

- 颜色配置已缓存，不再每帧查询 DOM

---

## 五、第三阶段：架构完善 + 数据层抽象 ✅ 已完成

### 5.1 数据 Service 层抽象 ✅

新建 `src/services/dashboardService.ts`，封装数据获取逻辑：

```typescript
export const getPortalData = async () => { ... }
export const getOverallData = async () => { ... }
export const getFinanceData = async () => { ... }
// ... 其他模块
```

### 5.2 Mock 数据拆分 ✅

`src/data/mockDashboard.ts` 已拆分为独立模块文件：

```
src/data/
├── portal.ts            # 首页数据
├── general.ts           # 综合看板
├── finance.ts           # 财务管理
├── treasury.ts          # 资金分析
├── investment.ts        # 投资管理
├── hr.ts                # 人力管理
├── asset.ts             # 资产管理
├── project.ts           # 经营管控
├── keyProjects.ts       # 重点项目
├── admin.ts             # 行政管理
├── index.ts             # 统一导出
└── mockDashboard.ts     # 向后兼容重导出
```

### 5.3 Pinia 状态管理整合 ✅

新建 `src/stores/dashboard.ts`，管理数据加载/缓存状态：

- 支持按模块独立加载或批量加载
- 提供加载状态（idle/loading/success/error）跟踪
- 提供缓存清除功能
- 为后续 API 对接做好准备

---

## 六、第四阶段：工程化 + 类型安全 ⏸️ 部分完成

### 6.1 添加 ESLint + Prettier ⏸️ 暂缓

待后续根据团队需求添加。

### 6.2 补充类型定义 ⏸️ 暂缓

待后续逐步完善。

### 6.3 硬编码颜色替换 ✅ 已完成

**已完成内容**：

1. **`themes.scss` 新增图表相关 CSS 变量**：
   - `--chart-axis-line: #2a3b54`
   - `--chart-axis-label: #a6bad2`
   - `--chart-split-line: #1d2a3d`
   - `--chart-label-line: rgba(166, 186, 210, 0.6)`
   - `--chart-shadow: rgba(12, 24, 40, 0.6)`
   - `--chart-border: rgba(7, 14, 24, 0.6)`

2. **`chartTheme.ts` 更新**：
   - 读取并缓存新增的 CSS 变量
   - 导出 `getThemeColors()` 供 Vue 组件使用

3. **Vue 组件硬编码颜色替换**：
   - `GeneralDetail.vue`：图表配置中的轴线、标签、阴影等颜色已改用 `getThemeColors()` 返回的变量
   - `FinanceDetail.vue`：图表配置中的硬编码颜色已替换
   - `HumanResourceDetail.vue`：饼图标签和线条颜色已替换

---

## 七、执行记录

| 日期 | 阶段 | 执行内容 | 验证结果 |
| :--- | :--- | :--- | :--- |
| 2026-02-09 | 第一阶段 | 清理多主题代码、删除未使用组件、路由懒加载 | `npm run build` 通过 |
| 2026-02-09 | 第二阶段 | 提取 composable、缓存颜色、优化组件 | `npm run build` 通过 |
| 2026-02-09 | 第三阶段 | 创建 Service 层、拆分 Mock 数据、整合 Pinia | `npm run build` 通过 |
| 2026-02-09 | 第四阶段 | 硬编码颜色替换为 CSS 变量 | `npm run build` 通过 |

---

## 八、后续建议

1. **ESLint + Prettier**：根据团队需求决定是否添加
2. **类型定义完善**：可在后续 API 对接时一并完善
3. **视图层迁移**：后续可将视图层的数据获取迁移到使用 `dashboardService` + `useDashboardStore`
4. **剩余硬编码颜色**：SVG 渐变定义（`stop-color`）和部分 SCSS 中的颜色仍使用硬编码，可视需求继续优化
